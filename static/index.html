<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser in Browser</title>
    <style>
        body { margin: 0; font-family: Arial; background: #fff; }
        #toolbar { display: flex; padding: 10px; background: #eee; align-items: center; gap: 5px; }
        button, input { padding: 6px 10px; font-size: 14px; }
        #url-bar { flex: 1; border: 1px solid #ccc; border-radius: 4px; }
        #iframe { width: 100%; height: calc(100vh - 52px); border: none; background: white; }
    </style>
</head>
<body>
    <div id="toolbar">
        <button onclick="goBack()">Back</button>
        <button onclick="goForward()">Forward</button>
        <button onclick="reload()">Reload</button>
        <input id="url-bar" type="text" placeholder="Enter URL..." value="https://www.example.com" onkeydown="if(event.key==='Enter') go()">
        <button onclick="go()">Go</button>
    </div>
    <iframe id="iframe" src="/proxy/https://www.example.com"></iframe>

    <script>
        const iframe = document.getElementById('iframe');
        const urlBar = document.getElementById('url-bar');

        function updateUrl() {
            const src = iframe.src;
            if (src.startsWith('/proxy/')) {
                try {
                    urlBar.value = decodeURIComponent(src.split('/proxy/')[1]);
                } catch {}
            }
        }

        iframe.onload = updateUrl;

        function go() {
            let url = urlBar.value.trim();
            if (!url) return;
            if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
            const proxied = `/proxy/${encodeURIComponent(url)}`;
            iframe.src = proxied;
            history.pushState({url: proxied}, '', proxied);
        }

        function reload() { iframe.src = iframe.src; }
        function goBack() { history.back(); }
        function goForward() { history.forward(); }

        window.onpopstate = () => {
            if (history.state && history.state.url) {
                iframe.src = history.state.url;
            }
            updateUrl();
        };

        // Initialize
        updateUrl();
    </script>
</body>
</html>